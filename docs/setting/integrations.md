# サービス別設定

## 共通設定

各サービスのセクションで設定できる共通設定。

|       キー       |               内容               |      型       |                省略時                 |                        備考                         |
| ---------------- | -------------------------------- | ------------- | ------------------------------------- | --------------------------------------------------- |
| separate         | スコア入力元識別子単位の集計     | 真偽値 / None | None(mahjongセクションの設定値を継承) | [mahjongセクション](customize.md#mahjongセクション) |
| badge_degree     | ゲーム数に応じて表示される称号   | 真偽値        | False                                 | [degreeセクション](customize.md#degreeセクション)   |
| badge_status     | 勝利によって表示される調子バッヂ | 真偽値        | False                                 | [statusセクション](customize.md#statusセクション)   |
| badge_grade      | 段位表示                         | 真偽値        | False                                 | [gradeセクション](customize.md#gradeセクション)     |
| plotting_backend | グラフ生成ライブラリ選択         | 文字列        | matplotlib                            | `matplotlib` / `plotly` から選択                    |

> [!CAUTION]
> `plotting_backend`は実装状況によってはデフォルト値から変更するとエラーとなる。

## slackセクション

|        キー         |                            内容                            |          型          |    省略時    |                              備考                              |
| ------------------- | ---------------------------------------------------------- | -------------------- | ------------ | -------------------------------------------------------------- |
| slash_command       | スラッシュコマンド名                                       | 文字列               | /mahjong     | 先頭のスラッシュも含める                                       |
| thread_report       | スレッド内にある成績記録キーワードを処理する               | 真偽値               | True         |                                                                |
| reaction_ok         | 素点合計が正しい場合に付けるリアクション                   | 文字列(絵文字)       | ok           | ゲーム結果のポスト、メモに対して付く                           |
| reaction_ng         | 素点合計が誤っている場合に付けるリアクション               | 文字列(絵文字)       | ng           | ゲーム結果のポストに対して付く                                 |
| ignore_userid       | 投稿内容を無視するユーザID                                 | 文字列               | 空欄         | 複数指定時はカンマ区切り                                       |
| channel_limitations | SQLを発行できるチャンネルID(カンマ区切り)                  | 文字列(channel_id)   | None         | 空欄の場合はすべてのチャンネル                                 |
| comparison_word     | 突合処理呼び出しキーワード                                 | 文字列               | 麻雀チェック |                                                                |
| comparison_alias    | スラッシュコマンドエイリアス(突合処理呼び出しサブコマンド) | 文字列(カンマ区切り) | 空欄         | サブコマンド `check` の別名を追加登録                          |
| search_channel      | 突合処理時に検索されるチャンネル                           | 文字列(チャンネル名) | *必須*       |                                                                |
| search_after        | データ突合開始日                                           | 数値                 | 7            | 突合実行日時から指定日を引いた日                               |
| search_wait         | 突合処理待ち時間(秒)                                       | 数値                 | 180          | イベント発生時刻から待ち時間以上経過したデータのみが突合の対象 |

> [!TIP]
> `ignore_userid`は、botが出力する内容が検索にヒットしてしまう状況でbotのIDを指定するような利用方法を想定している。

> [!TIP]
> `channel_limitations`は複数のチャンネルにbotをIntegrationsしている状態で、参照専用のチャンネルを作成するような利用方法を想定している。

### チャンネル個別設定

`slack_<チャンネルID>`セクションがあればそのチャンネル専用(slackセクションの設定を上書き)の設定。

|      キー      |                     内容                     |          型          | 省略時 |                                         備考                                          |
| -------------- | -------------------------------------------- | -------------------- | ------ | ------------------------------------------------------------------------------------- |
| reaction_ok    | 素点合計が正しい場合に付けるリアクション     | 文字列(絵文字)       | 引継   | `slack`セクションの設定を上書き                                                       |
| reaction_ng    | 素点合計が誤っている場合に付けるリアクション | 文字列(絵文字)       | 引継   | `slack`セクションの設定を上書き                                                       |
| search_channel | 突合処理時に検索されるチャンネル             | 文字列(チャンネル名) | 引継   | `slack`セクションの設定を上書き                                                       |
| search_after   | データ突合開始日                             | 数値                 | 引継   | `slack`セクションの設定を上書き                                                       |
| channel_config | 個別設定ファイル                             | 文字列(ファイルパス) | None   | `mahjong`、`setting`、`results`、`graph`、`ranking`、`report`セクションの設定を上書き |

> [!TIP]
> `channel_config`で設定されたセクションは、[設定ファイル](customize.md)で設定されているセクションとマージされる。
> 後から読み込まれる`channel_config`で上書きする。
> `commandword`、`help`で指定されているキーワードは上書きできない。

## discordセクション

|        キー         |                            内容                            |          型          |    省略時    |                                 備考                                 |
| ------------------- | ---------------------------------------------------------- | -------------------- | ------------ | -------------------------------------------------------------------- |
| slash_command       | スラッシュコマンド名                                       | 文字列               | mahjong      | 先頭にスラッシュは不要                                               |
| channel_limitations | SQLを発行できるチャンネル(カンマ区切り)                    | 文字列               | None         | チャンネルID、チャンネル名で指定可<br>空欄の場合はすべてのチャンネル |
| comparison_word     | 突合処理呼び出しキーワード                                 | 文字列               | 麻雀チェック |                                                                      |
| comparison_alias    | スラッシュコマンドエイリアス(突合処理呼び出しサブコマンド) | 文字列(カンマ区切り) | 空欄         | サブコマンド `check` の別名を追加登録                                |
| search_after        | データ突合開始日                                           | 数値                 | 7            | 突合実行日時から指定日を引いた日                                     |

> [!TIP]
> botが参加してるチャンネルが複数ある場合、`channel_limitations`を指定することで成績登録ができるチャンネルを制限できる。
> サマリやグラフなどは制限されない。

## webセクション

|       キー        |               内容                |          型          |  省略時   |                                           備考                                            |
| ----------------- | --------------------------------- | -------------------- | --------- | ----------------------------------------------------------------------------------------- |
| host              |                                   | 文字列               | 127.0.0.1 |                                                                                           |
| port              |                                   | 数値                 | 8000      |                                                                                           |
| require_auth      | BASIC認証を使うか                 | 真偽値               | False     | `username` / `password` のいずれかが未定義なら `False`                                    |
| username          | 認証ユーザ名                      | 文字列               | 空欄      |                                                                                           |
| password          | 認証パスワード                    | 文字列               | 空欄      | 平文指定                                                                                  |
| use_ssl           | HTTPSを利用するか                 | 真偽値               | False     | `certificate` / `private_key` のいずれかが未定義なら `False`                              |
| certificate       | サーバー証明書保存パス            | 文字列               | 空欄      |                                                                                           |
| private_key       | 秘密鍵保存パス                    | 文字列               | 空欄      |                                                                                           |
| view_summary      | 成績サマリの表示                  | 真偽値               | True      |                                                                                           |
| view_graph        | グラフの表示                      | 真偽値               | True      |                                                                                           |
| view_ranking      | ランキングの表示                  | 真偽値               | True      |                                                                                           |
| management_member | メンバー/チーム編集メニューの表示 | 真偽値               | False     |                                                                                           |
| management_score  | 成績管理メニューの表示            | 真偽値               | False     |                                                                                           |
| theme             | 配色テーマを選択                  | 文字列               | 空欄      | [配色テーマ](#配色テーマ)のキーワードから選択<br>空欄時はどのスタイルシートも適応されない |
| custom_css        | カスタマイズスタイルシート[^1]    | 文字列(ファイルパス) | 空欄      | ファイルが存在しない場合は空欄になる                                                      |
| plotting_backend  | グラフ生成ライブラリ選択          | 文字列               | plotly    | 共通設定を上書き                                                                          |

[^1]: 設定ファイルからの相対パスで指定

### 配色テーマ

| キーワード |           特徴           |
| ---------- | ------------------------ |
| black      | 黒色ベースのモノクロ配色 |
| midnight   | 濃い青色ベースの配色     |
| pastel     | 明るいパステル調の配色   |
| sepia      | 明るいセピア調の配色     |
| white      | 白色ベースのモノクロ配色 |

無効なキーワードは無視され、空欄となる。

## standard_io

個別設定なし
