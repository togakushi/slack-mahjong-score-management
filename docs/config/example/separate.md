# チャンネルセパレート機能設定例
## 機能概要
チャンネルセパレート機能(以下、セパレート機能)は集計コマンド(サマリ出力やグラフ出力など)で集計するデータを ***チャンネル識別子*** で区別する設定となる。

記録されるゲーム結果には「成績登録キーワード」が発行されたチャンネル固有の ***チャンネル識別子*** が保存され、「どこから入力されたデータか」を区別できるようになっている。

### チャンネル識別子のフォーマット
```
<サービス名>_<サービス内で使われるチャンネルID>
```

連携先サービス名のプレフィックスを持ち、そのサービス内で用いられる`channel_id`などのチャンネルを識別するためのIDが続く形をとる。

チャンネル識別子は[`settingセクション`](../mainconf.md#settingセクション) などで `channel_id` を定義することで自由に変更できる。\
チャンネル単位でのグループ分けを行ったり、Slackワークスペースの変更対応などで利用できる。

### 集計データ抽出ルール
基本となるデータ抽出条件はルールセット単位となり、「ルールバージョン」が抽出条件として指定されている。\
「成績登録キーワード」で保存される成績は[マッピング設定](../mainconf.md#keyword_mappingセクション)によってどのルールセットを使うかが定義されている。\
異なるサービスや異なるチャンネルでも同じマッピングの定義であれば、同じ「ルールバージョン識別子」が使用される。\
同じルールセットを使用していれば、Discordで入力された成績データをSlackで参照できる。

セパレート機能を有効にした場合、データの抽出条件に ***チャンネル識別子*** が追加され、集計コマンドを発行したチャンネルの ***チャンネル識別子*** を持つデータだけが集計対象となる。

付与されるチャンネル識別子は「ヘルプ」機能で内容を[確認](#サービス個別設定状況)できる。

### セパレート機能設定箇所
`separate`キーを`True`にセットすれば有効になる。\
設定できるセクションは以下になる（メイン設定内限定）。

- settingセクション
- 各サービスのセクション
- チャンネル個別設定

設定箇所による有効範囲は以下のようになる。

#### メイン設定
```
[setting]
separate = True
```

メイン設定のセパレート機能有効化は、全サービス、全チャンネルのデータを分けて集計するようになる。
- Slack / Discord で入力されたデータを区別
- 各サービス内の各チャンネルで入力されたデータを区別

#### サービス設定
```
[slack]
separate = True

[discord]
separate = True
```

サービス設定のセパレート機能有効化は、Slack / Discord のデータを分ける。\
同じルールセットの記録でもSlackで実行した集計コマンドの結果にDiscordから登録されたデータは含まれない。

#### チャンネル個別設定
```
[slack_Cxxxxxxxxxx]
separate = True

[discord_xxxxxxxxxxxxxxxxxxx]
separate = True
```

チャンネル個別設定で使用するセクション名は「***<サービス名>_<サービス内で使われるチャンネルID>*** 」となる(変更不可)。

チャンネルAで有効、チャンネルBは無効とし、同じルールセットの記録を集計する場合は以下のように集計される。

**チャンネルA**
- 集計コマンドの抽出条件に ***チャンネル識別子*** が追加される
  - チャンネルAで入力されたデータ：集計対象
  - チャンネルBで入力されたデータ：集計対象外

**チャンネルB**
- 集計コマンドの抽出条件はルールバージョンのみ
  - チャンネルAで入力されたデータ：集計対象
  - チャンネルBで入力されたデータ：集計対象

### チャンネル設定情報
「ヘルプ」コマンドにチャンネルの設定情報が表示される。\
チャンネルセパレート機能が有効になっているか、使用されるチャンネル識別子の確認ができる。

#### Slack
```
【チャンネル設定情報】
チャンネル識別子：slack_Cxxxxxxxxxx
チャンネル個別設定：---
チャンネルセパレート：有効
データベースファイル：mahjong.db
```

#### Discord
```
【チャンネル設定情報】
チャンネル識別子：discord_xxxxxxxxxxxxxxxxxxx
チャンネル個別設定：---
チャンネルセパレート：有効
データベースファイル：mahjong.db
```
