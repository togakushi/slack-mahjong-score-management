# チャンネルセパレート機能活用例
## セパレート機能概要
セパレート機能は集計コマンド(サマリ出力やグラフ出力など)で集計するデータを ***チャンネル識別子*** で区別する設定となる。

記録されるゲーム結果には「成績登録キーワード」が発行された連携サービス先のチャンネルIDに基づく ***チャンネル識別子*** が保存される。\
この ***チャンネル識別子*** を用いて「どこから入力されたデータか」を区別できるようになっている。

チャンネル識別子のフォーマット
```
<サービス名>_<サービス内で使われるチャンネルID>
```

チャンネル識別子として記録される文字列は[`settingセクション`](../mainconf.md#settingセクション) などで `channel_id` を定義することで変更できる。\
チャンネル単位でグループ分けを行ったり、Slackワークスペースの変更などに対応できる。

### 集計データ抽出ルール
基本となるデータ抽出条件はルールセット単位となる。これは「ルールバージョン」として条件付けされる。\
「成績登録キーワード」で保存される成績は[マッピング設定](../mainconf.md#keyword_mappingセクション)によってどのルールセットを使うかが定義されている。\
異なるサービスや異なるチャンネルでも同じマッピングの定義であれば、同じ「ルールバージョン識別子」が使用される。\
同じルールセットを使用していれば、Discordで入力された成績データをSlackで参照できることができる。

セパレート機能を有効にした場合、データの抽出条件に ***チャンネル識別子*** が追加される。\
集計コマンドを発行したチャンネルの ***チャンネル識別子*** を持つデータだけが集計対象となる。

付与されるチャンネル識別子は「ヘルプ」機能で内容を[確認](#サービス個別設定状況)できる。

### セパレート機能設定箇所
`separate`キーを`True`にセットすれば有効になる。\
設定できるセクションは以下になる（メイン設定内限定）。
- settingセクション
  ```
  [setting]
  separate = True
  ```
- 各サービスのセクション
  ```
  [slack]
  separate = True

  [discord]
  separate = True
  ```
- チャンネル個別設定
  ```
  [slack_Cxxxxxxxxxx]
  separate = True

  [discord_xxxxxxxxxxxxxxxxxxx]
  separate = True
  ```

### 有効範囲

#### メイン設定
メイン設定のセパレート機能有効化は、全サービス、全チャンネルのデータを分けて集計するようになる。
- Slack / Discord で入力されたデータを区別
- 各サービス内の各チャンネルで入力されたデータを区別

#### チャンネル個別設定
メイン設定に ***チャンネル識別子*** と同じ名称のセクションを追加し、



#### チャンネル設定情報
「ヘルプ」コマンドにチャンネルの設定情報が表示される。\
チャンネルセパレート機能が有効になっているか、使用されるチャンネル識別子の確認ができる。

##### Slack
```
【チャンネル設定情報】
チャンネル識別子：slack_Cxxxxxxxxxx
チャンネル個別設定：---
チャンネルセパレート：有効
データベースファイル：mahjong.db
```

##### Discord
```
【チャンネル設定情報】
チャンネル識別子：discord_xxxxxxxxxxxxxxxxxxx
チャンネル個別設定：---
チャンネルセパレート：有効
データベースファイル：mahjong.db
```
